/**
 * Created by Administrator on 2015/8/2.
 */
(function(){angular.module("angular-loading-bar",["cfp.loadingBarInterceptor"]);angular.module("chieffancypants.loadingBar",["cfp.loadingBarInterceptor"]);angular.module("cfp.loadingBarInterceptor",["cfp.loadingBar"]).config(["$httpProvider",function(a){var b=["$q","$cacheFactory","$timeout","$rootScope","$log","cfpLoadingBar",function(j,k,f,l,n,h){var g=0;var c=0;var e=h.latencyThreshold;var d;function i(){f.cancel(d);h.complete();c=0;g=0}function m(p){var o;var r=k.get("$http");var s=a.defaults;if((p.cache||s.cache)&&p.cache!==false&&(p.method==="GET"||p.method==="JSONP")){o=angular.isObject(p.cache)?p.cache:angular.isObject(s.cache)?s.cache:r}var q=o!==undefined?o.get(p.url)!==undefined:false;if(p.cached!==undefined&&q!==p.cached){return p.cached}p.cached=q;return q}return{"request":function(o){if(!o.ignoreLoadingBar&&!m(o)){l.$broadcast("cfpLoadingBar:loading",{url:o.url});if(g===0){d=f(function(){h.start()},e)}g++;h.set(c/g)}return o},"response":function(o){if(!o||!o.config){n.error("Broken interceptor detected: Config object not supplied in response:\n https://github.com/chieffancypants/angular-loading-bar/pull/50");return o}if(!o.config.ignoreLoadingBar&&!m(o.config)){c++;l.$broadcast("cfpLoadingBar:loaded",{url:o.config.url,result:o});if(c>=g){i()}else{h.set(c/g)}}return o},"responseError":function(o){if(!o||!o.config){n.error("Broken interceptor detected: Config object not supplied in rejection:\n https://github.com/chieffancypants/angular-loading-bar/pull/50");return j.reject(o)}if(!o.config.ignoreLoadingBar&&!m(o.config)){c++;l.$broadcast("cfpLoadingBar:loaded",{url:o.config.url,result:o});if(c>=g){i()}else{h.set(c/g)}}return j.reject(o)}}}];a.interceptors.push(b)}]);angular.module("cfp.loadingBar",[]).provider("cfpLoadingBar",function(){this.autoIncrement=true;this.includeSpinner=true;this.includeBar=true;this.latencyThreshold=100;this.startSize=0.02;this.parentSelector="body";this.spinnerTemplate='<div id="loading-bar-spinner"><div class="spinner-icon"></div></div>';this.loadingBarTemplate='<div id="loading-bar"><div class="bar"><div class="peg"></div></div></div>';this.$get=["$injector","$document","$timeout","$rootScope",function(p,w,v,h){var q;var c=this.parentSelector,j=angular.element(this.loadingBarTemplate),d=j.find("div").eq(0),f=angular.element(this.spinnerTemplate);var r,t,a=false,n=0;var i=this.autoIncrement;var g=this.includeSpinner;var k=this.includeBar;var u=this.startSize;function s(){if(!q){q=p.get("$animate")}var x=w.find(c).eq(0);v.cancel(t);if(a){return}h.$broadcast("cfpLoadingBar:started");a=true;if(k){q.enter(j,x,angular.element(x[0].lastChild))}if(g){q.enter(f,x,angular.element(x[0].lastChild))}m(u)}function m(y){if(!a){return}var x=(y*100)+"%";d.css("width",x);n=y;if(i){v.cancel(r);r=v(function(){l()},250)}}function l(){if(b()>=1){return}var x=0;var y=b();if(y>=0&&y<0.25){x=(Math.random()*(5-3+1)+3)/100}else{if(y>=0.25&&y<0.65){x=(Math.random()*3)/100}else{if(y>=0.65&&y<0.9){x=(Math.random()*2)/100}else{if(y>=0.9&&y<0.99){x=0.005}else{x=0}}}}var z=b()+x;m(z)}function b(){return n}function e(){n=0;a=false}function o(){if(!q){q=p.get("$animate")}h.$broadcast("cfpLoadingBar:completed");m(1);v.cancel(t);t=v(function(){var x=q.leave(j,e);if(x&&x.then){x.then(e)}q.leave(f)},500)}return{start:s,set:m,status:b,inc:l,complete:o,autoIncrement:this.autoIncrement,includeSpinner:this.includeSpinner,latencyThreshold:this.latencyThreshold,parentSelector:this.parentSelector,startSize:this.startSize}}]})})();